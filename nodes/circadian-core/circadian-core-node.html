<script type="text/javascript">
  RED.nodes.registerType('circadian core',{
    category: 'Freya Vivariums',
    color: "#A2CA6F",
    defaults: {
      name: {value:""},
      locationConfig: {value:"", type:"location-config", required:true},
      phaseShift: {value: 0.0, required: true, validate: RED.validators.number()},
      tickInterval: {value: 60, required: true, validate: function(v) { return RED.validators.number()(v) && parseInt(v) >= 1; }},
      decimals: {value: 1, required: true, validate: function(v) { return RED.validators.number()(v) && parseInt(v) >= 0 && parseInt(v) <= 4; }}
    },
    inputs:1,
    outputs:2,
    outputLabels:["control", "status"],
    icon: "font-awesome/fa-globe",
    label: function() {
      return this.name || "Circadian Core";
    }
  });
</script>


<script type="text/html" data-template-name="circadian core">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Circadian Core">
    </div>
    <hr/>
    <div class="form-row">
        <label for="node-input-locationConfig"><i class="fa fa-map-marker"></i> Location Config</label>
        <input type="text" id="node-input-locationConfig">
        <i class="fa fa-info-circle" title="Select a location configuration node that defines geographic and planetary parameters."></i>
    </div>
    <hr/>
    <div class="form-row">
        <label for="node-input-phaseShift"><i class="fa fa-clock-o"></i> Phase Shift (°)</label>
        <input type="number" id="node-input-phaseShift" placeholder="0" step="1" min="-180" max="180">
        <i class="fa fa-info-circle" title="Phase shift in degrees relative to solar cycle. 0° = peak at solar noon, 180° = peak at solar midnight, 30-45° = afternoon temperature lag."></i>
    </div>
    <div class="form-row">
        <label for="node-input-tickInterval"><i class="fa fa-clock-o"></i> Tick Interval (seconds)</label>
        <input type="number" id="node-input-tickInterval" placeholder="60" step="1" min="1">
        <div class="form-tips">How often to automatically recalculate and emit target values</div>
    </div>
    <div class="form-row">
        <label for="node-input-decimals"><i class="fa fa-calculator"></i> Decimal Places</label>
        <input type="number" id="node-input-decimals" placeholder="1" step="1" min="0" max="4">
        <div class="form-tips">Number of decimal places to round the output target value (0-4)</div>
    </div>
</script>



<script type="text/html" data-help-name="circadian core">
  <p>
    The <strong>Circadian Core</strong> dynamically computes target values for key vivarium variables 
    (temperature, humidity, light), creating natural circadian and seasonal rhythms based on 
    astronomical calculations and geographic location.
  </p>
  
  <h3>Configuration</h3>
  <ul>
    <li><strong>Location Config:</strong> Reference to a shared location configuration node</li>
    <li><strong>Phase Shift:</strong> Degrees of lead/lag relative to solar cycle (0° = solar noon peak)</li>
  </ul>
  
  <h3>Input</h3>
  <p>
    Send numeric values with <code>msg.topic</code> set to:
  </p>
  <ul>
    <li><code>"absoluteMin"</code> or <code>"min"</code> - Minimum value (winter night)</li>
    <li><code>"absoluteMax"</code> or <code>"max"</code> - Maximum value (summer day)</li>
  </ul>
  
  <h3>Outputs</h3>
  <ul>
    <li><strong>Output 1:</strong> Target value - calculated setpoint based on current simulated time</li>
    <li><strong>Output 2:</strong> Status - detailed information including simulated time and time scale</li>
  </ul>
  
  <p>
    The node combines seasonal and diurnal cycles to interpolate between absolute min/max values, 
    automatically adjusting for day length variations, latitude effects, and custom planetary parameters.
  </p>
</script>